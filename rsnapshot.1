.\" Automatically generated by Pod::Man v1.37, Pod::Parser v1.14
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sh \" Subsection heading
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  | will give a
.\" real vertical bar.  \*(C+ will give a nicer C++.  Capital omega is used to
.\" do unbreakable dashes and therefore won't be available.  \*(C` and \*(C'
.\" expand to `' in nroff, nothing in troff, for use with C<>.
.tr \(*W-|\(bv\*(Tr
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.Sh), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.if \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.\"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.hy 0
.if n .na
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "rsnapshot 1"
.TH rsnapshot 1 "2008-08-31" "" ""
.SH "NAME"
rsnapshot \- remote filesystem snapshot utility
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
\&\fBrsnapshot\fR [\fB\-vtxqVD\fR] [\fB\-c\fR cfgfile] [command] [args]
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
\&\fBrsnapshot\fR is a filesystem snapshot utility. It can take incremental
snapshots of local and remote filesystems for any number of machines.
.PP
Local filesystem snapshots are handled with \fB\f(BIrsync\fB\|(1)\fR. Secure remote
connections are handled with rsync over \fB\f(BIssh\fB\|(1)\fR, while anonymous
rsync connections simply use an rsync server. Both remote and local
transfers depend on rsync.
.PP
\&\fBrsnapshot\fR saves much more disk space than you might imagine. The amount
of space required is roughly the size of one full backup, plus a copy
of each additional file that is changed. \fBrsnapshot\fR makes extensive
use of hard links, so if the file doesn't change, the next snapshot is
simply a hard link to the exact same file.
.PP
\&\fBrsnapshot\fR will typically be invoked as root by a cron job, or series
of cron jobs. It is possible, however, to run as any arbitrary user
with an alternate configuration file.
.PP
All important options are specified in a configuration file, which is
located by default at \fB/etc/rsnapshot.conf\fR. An alternate file can be
specified on the command line. There are also additional options which
can be passed on the command line.
.PP
The command line options are as follows:
.Sp
.RS 4
\&\fB\-v\fR verbose, show shell commands being executed
.Sp
\&\fB\-t\fR test, show shell commands that would be executed
.Sp
\&\fB\-c\fR path to alternate config file
.Sp
\&\fB\-x\fR one filesystem, don't cross partitions within each backup point
.Sp
\&\fB\-q\fR quiet, suppress non-fatal warnings
.Sp
\&\fB\-V\fR same as \-v, but with more detail
.Sp
\&\fB\-D\fR a firehose of diagnostic information
.RE
.SH "CONFIGURATION"
.IX Header "CONFIGURATION"
\&\fB/etc/rsnapshot.conf\fR is the default configuration file. All parameters
in this file must be separated by tabs. \fB/etc/rsnapshot.conf.default\fR
can be used as a reference.
.PP
It is recommended that you copy \fB/etc/rsnapshot.conf.default\fR to
\&\fB/etc/rsnapshot.conf\fR, and then modify \fB/etc/rsnapshot.conf\fR to suit
your needs.
.PP
Long lines may be split over several lines.  \*(L"Continuation\*(R" lines
\&\fBmust\fR begin with a space or a tab character.  Continuation lines will
have all leading and trailing whitespace stripped off, and then be appended
with an intervening tab character to the previous line when the configuation
file is parsed.
.PP
Here is a list of allowed parameters:
.Sp
.RS 4
\&\fBconfig_version\fR     Config file version (required). Default is 1.2
.Sp
\&\fBsnapshot_root\fR      Local filesystem path to save all snapshots
.Sp
\&\fBinclude_conf\fR       Include another file in the configuration at this point.
.Sp
.RS 4
This is recursive, but you may need to be careful about paths when specifying
which file to include.  We check to see if the file you have specified is
readable, and will yell an error if it isn't.  We recommend using a full
path.  As a special case, include_conf's value may be enclosed in `backticks`
in which case it will be executed and whatever it spits to \s-1STDOUT\s0 will
be included in the configuration.  Note that shell meta-characters may be
interpreted.
.RE
.RE
.RS 4
.Sp
\&\fBno_create_root\fR     If set to 1, rsnapshot won't create snapshot_root directory
.Sp
\&\fBcmd_rsync\fR          Full path to rsync (required)
.Sp
\&\fBcmd_ssh\fR            Full path to ssh (optional)
.Sp
\&\fBcmd_cp\fR             Full path to cp  (optional, but must be \s-1GNU\s0 version)
.Sp
.RS 4
If you are using Linux, you should uncomment cmd_cp. If you are using a
platform which does not have \s-1GNU\s0 cp, you should leave cmd_cp commented out.
.Sp
With \s-1GNU\s0 cp, rsnapshot can take care of both normal files and special
files (such as FIFOs, sockets, and block/character devices) in one pass.
.Sp
If cmd_cp is disabled, rsnapshot will use its own built-in function,
\&\fInative_cp_al()\fR to backup up regular files and directories. This will
then be followed up by a separate call to rsync, to move the special
files over (assuming there are any).
.RE
.RE
.RS 4
.Sp
\&\fBcmd_rm\fR             Full path to rm (optional)
.Sp
\&\fBcmd_logger\fR         Full path to logger (optional, for syslog support)
.Sp
\&\fBcmd_du\fR             Full path to du (optional, for disk usage reports)
.Sp
\&\fBcmd_rsnapshot_diff\fR Full path to rsnapshot-diff (optional)
.Sp
\&\fBcmd_preexec\fR
.Sp
.RS 4
Full path (plus any arguments) to preexec script (optional).
This script will run immediately before each backup operation (but not any
rotations).
.RE
.RE
.RS 4
.Sp
\&\fBcmd_postexec\fR
.Sp
.RS 4
Full path (plus any arguments) to postexec script (optional).
This script will run immediately after each backup operation (but not any
rotations).
.RE
.RE
.RS 4
.Sp
\&\fBlinux_lvm_cmd_lvcreate\fR
.Sp
\&\fBlinux_lvm_cmd_lvremove\fR
.Sp
\&\fBlinux_lvm_cmd_mount\fR
.Sp
\&\fBlinux_lvm_cmd_umount\fR
.Sp
.RS 4
Paths to lvcreate, lvremove, mount and umount commands, for use with Linux
LVMs.  The lvcreate, lvremove, mount and umount commands are required for
managing snapshots of \s-1LVM\s0 volumes and are otherwise optional.
.RE
.RE
.RS 4
.Sp
\&\fBretain\fR             [name]   [number]
.Sp
.RS 4
\&\*(L"name\*(R" refers to the name of this backup level (e.g., hourly, daily,
so also called the 'interval'). \*(L"number\*(R"
is the number of snapshots for this type of interval that will be retained.
The value of \*(L"name\*(R" will be the command passed to \fBrsnapshot\fR to perform
this type of backup.
.Sp
A deprecated alias for 'retain' is 'interval'.
.Sp
Example: \fBretain hourly 6\fR
.Sp
[root@localhost]# \fBrsnapshot hourly\fR
.Sp
For this example, every time this is run, the following will happen:
.Sp
<snapshot_root>/hourly.5/ will be deleted, if it exists.
.Sp
<snapshot_root>/hourly.{1,2,3,4} will all be rotated +1, if they exist.
.Sp
<snapshot_root>/hourly.0/ will be copied to <snapshot_root>/hourly.1/
using hard links.
.Sp
Each backup point (explained below) will then be rsynced to the
corresponding directories in <snapshot_root>/hourly.0/
.Sp
Backup levels must be specified in the config file in order, from most
frequent to least frequent. The first entry is the one which will be
synced with the backup points. The subsequent backup levels (e.g., daily,
weekly, etc) simply rotate, with each higher backup level pulling from the
one below it for its .0 directory.
.Sp
Example:
.Sp
.RS 4
\&\fBretain  hourly 6\fR
.Sp
\&\fBretain  daily  7\fR
.Sp
\&\fBretain  weekly 4\fR
.RE
.RE
.RS 4
.Sp
daily.0/ will be copied from hourly.5/, and weekly.0/ will be copied from daily.6/
.Sp
hourly.0/ will be rsynced directly from the filesystem.
.RE
.RE
.RS 4
.Sp
\&\fBlink_dest           1\fR
.Sp
.RS 4
If your version of rsync supports \-\-link\-dest (2.5.7 or newer), you can enable
this to let rsync handle some things that \s-1GNU\s0 cp or the built-in subroutines would
otherwise do. Enabling this makes rsnapshot take a slightly more complicated code
branch, but it's the best way to support special files on non-Linux systems.
.RE
.RE
.RS 4
.Sp
\&\fBsync_first          1\fR
.Sp
.RS 4
sync_first changes the behaviour of rsnapshot. When this is enabled, all calls
to rsnapshot with various backup levels simply rotate files. All backups are handled
by calling rsnapshot with the \*(L"sync\*(R" argument. The synced files are stored in
a \*(L".sync\*(R" directory under the snapshot_root.
.Sp
This allows better recovery in the event that rsnapshot is interrupted in the
middle of a sync operation, since the sync step and rotation steps are
separated. This also means that you can easily run \*(L"rsnapshot sync\*(R" on the
command line without fear of forcing all the other directories to rotate up.
This benefit comes at the cost of one more snapshot worth of disk space.
The default is 0 (off).
.RE
.RE
.RS 4
.Sp
\&\fBverbose             2\fR
.Sp
.RS 4
The amount of information to print out when the program is run. Allowed values
are 1 through 5. The default is 2.
.Sp
.Vb 5
\&    1        Quiet            Show fatal errors only
\&    2        Default          Show warnings and errors
\&    3        Verbose          Show equivalent shell commands being executed
\&    4        Extra Verbose    Same as verbose, but with more detail
\&    5        Debug            All kinds of information
.Ve
.RE
.RE
.RS 4
.Sp
\&\fBloglevel            3\fR
.Sp
.RS 4
This number means the same thing as \fBverbose\fR above, but it determines how
much data is written to the logfile, if one is being written.
.Sp
The only thing missing from this at the higher levels is the direct output
from rsync. We hope to add support for this in a future release.
.RE
.RE
.RS 4
.Sp
\&\fBlogfile             /var/log/rsnapshot\fR
.Sp
.RS 4
Full filesystem path to the rsnapshot log file. If this is defined, a log file
will be written, with the amount of data being controlled by \fBloglevel\fR. If
this is commented out, no log file will be written.
.RE
.RE
.RS 4
.Sp
\&\fBinclude             [file\-name\-pattern]\fR
.Sp
.RS 4
This gets passed directly to rsync using the \-\-include directive. This
parameter can be specified as many times as needed, with one pattern defined
per line. See the \fIrsync\fR\|(1) man page for the syntax.
.RE
.RE
.RS 4
.Sp
\&\fBexclude             [file\-name\-pattern]\fR
.Sp
.RS 4
This gets passed directly to rsync using the \-\-exclude directive. This
parameter can be specified as many times as needed, with one pattern defined
per line. See the \fIrsync\fR\|(1) man page for the syntax.
.RE
.RE
.RS 4
.Sp
\&\fBinclude_file        /path/to/include/file\fR
.Sp
.RS 4
This gets passed directly to rsync using the \-\-include\-from directive. See the
\&\fIrsync\fR\|(1) man page for the syntax.
.RE
.RE
.RS 4
.Sp
\&\fBexclude_file        /path/to/exclude/file\fR
.Sp
.RS 4
This gets passed directly to rsync using the \-\-exclude\-from directive. See the
\&\fIrsync\fR\|(1) man page for the syntax.
.RE
.RE
.RS 4
.Sp
\&\fBrsync_short_args    \-a\fR
.Sp
.RS 4
List of short arguments to pass to rsync. If not specified,
\&\*(L"\-a\*(R" is the default. Please note that these must be all next to each other.
For example, \*(L"\-az\*(R" is valid, while \*(L"\-a \-z\*(R" is not.
.Sp
\&\*(L"\-a\*(R" is rsync's \*(L"archive mode\*(R" which tells it to copy as much of the
filesystem metadata as it can for each file.  This specifically does *not*
include information about hard links, as that would greatly increase rsync's
memory usage and slow it down.  If you need to preserve hard links in your
backups, then add \*(L"H\*(R" to this.
.RE
.RE
.RS 4
.Sp
\&\fBrsync_long_args     \-\-delete \-\-numeric\-ids \-\-relative \-\-delete\-excluded\fR
.Sp
.RS 4
List of long arguments to pass to rsync. Beginning with rsnapshot 1.2.0, this
default has changed. In previous versions, the default values were
.Sp
.Vb 1
\&    --delete --numeric-ids
.Ve
.Sp
Starting with version 1.2.0, the default values are
.Sp
.Vb 1
\&    --delete --numeric-ids --relative --delete-excluded
.Ve
.Sp
This directly affects how the destination paths in your backup points are
constructed. Depending on what behaviour you want, you can explicitly set
the values to make the program behave like the old version or the current
version. The newer settings are recommended if you're just starting. If
you are upgrading, read the upgrade guide in the \s-1INSTALL\s0 file in the
source distribution for more information.
.Sp
Quotes are permitted in rsync_long_args, eg \-\-rsync\-path=\*(L"sudo /usr/bin/rsync\*(R".
You may use either single (') or double (") quotes, but nested quotes (including
mixed nested quotes) are not permitted.  Similar quoting is also allowed in
per-backup-point rsync_long_args.
.RE
.RE
.RS 4
.Sp
\&\fBssh_args    \-p 22\fR
.Sp
.RS 4
Arguments to be passed to ssh. If not specified, the default is none.
.RE
.RE
.RS 4
.Sp
\&\fBdu_args     \-csh\fR
.Sp
.RS 4
Arguments to be passed to du. If not specified, the default is \-csh.
\&\s-1GNU\s0 du supports \-csh, \s-1BSD\s0 du supports \-csk, Solaris du doesn't support
\&\-c at all. The \s-1GNU\s0 version is recommended, since it offers the most
features.
.RE
.RE
.RS 4
.Sp
\&\fBlockfile    /var/run/rsnapshot.pid\fR
.Sp
\&\fBstop_on_stale_lockfile	0\fR
.Sp
.RS 4
Lockfile to use when rsnapshot is run. This prevents a second invocation
from clobbering the first one. If not specified, no lock file is used.
Make sure to use a directory that is not world writeable for security
reasons.  Use of a lock file is strongly recommended.
.Sp
If a lockfile exists when rsnapshot starts, it will try to read the file
and stop with an error if it can't.  If it *can* read the file, it sees if
a process exists with the \s-1PID\s0 noted in the file.  If it does, rsnapshot
stops with an error message.  If there is no process with that \s-1PID\s0, then
we assume that the lockfile is stale and ignore it *unless*
stop_on_stale_lockfile is set to 1 in which case we stop.
.Sp
stop_on_stale_lockfile defaults to 0.
.RE
.RE
.RS 4
.Sp
\&\fBone_fs    1\fR
.Sp
.RS 4
Prevents rsync from crossing filesystem partitions. Setting this to a value
of 1 enables this feature. 0 turns it off. This parameter is optional.
The default is 0 (off).
.RE
.RE
.RS 4
.Sp
\&\fBuse_lazy_deletes    1\fR
.Sp
.RS 4
Changes default behavior of rsnapshot and does not initially remove the 
oldest snapshot. Instead it moves that directory to _delete.[processid] and
continues as normal. Once the backup has been completed, the lockfile will
be removed before rsnapshot starts deleting the directory.
.Sp
Enabling this means that snapshots get taken sooner (since the delete doesn't
come first), and any other rsnapshot processes are allowed to start while the
final delete is happening. This benefit comes at the cost of using more
disk space. The default is 0 (off).
.Sp
The details of how this works have changed in rsnapshot version 1.3.1.
Originally you could only ever have one .delete directory per backup level.
Now you can have many, so if your next (eg) hourly backup kicks off while the
previous one is still doing a lazy delete you may temporarily have extra
_delete directories hanging around.
.RE
.RE
.RS 4
.Sp
\&\fBlinux_lvm_snapshotsize    2G\fR
.Sp
.RS 4
\&\s-1LVM\s0 snapshot(s) size (lvcreate \-\-size option).
.RE
.RE
.RS 4
.Sp
\&\fBlinux_lvm_snapshotname  rsnapshot\fR
.Sp
.RS 4
Name to be used when creating the \s-1LVM\s0 logical volume snapshot(s) (lvcreate \-\-name option).
.RE
.RE
.RS 4
.Sp
\&\fBlinux_lvm_vgpath		/dev\fR
.Sp
.RS 4
Path to the \s-1LVM\s0 Volume Groups.
.RE
.RE
.RS 4
.Sp
\&\fBlinux_lvm_mountpath		/mnt/lvm\-snapshot\fR
.Sp
.RS 4
Mount point to use to temporarily mount the snapshot(s). 
.RE
.RE
.RS 4
.Sp
\&\fB\s-1UPGRADE\s0 \s-1NOTICE:\s0\fR
.Sp
.RS 4
If you have used an older version of rsnapshot, you might notice that the
destination paths on the backup points have changed. Please read the \s-1INSTALL\s0
file in the source distribution for upgrade options.
.RE
.RE
.RS 4
.Sp
\&\fBbackup\fR  /etc/                       localhost/
.Sp
\&\fBbackup\fR  root@example.com:/etc/      example.com/
.Sp
\&\fBbackup\fR  rsync://example.com/path2/  example.com/
.Sp
\&\fBbackup\fR  /var/                       localhost/      one_fs=1
.Sp
\&\fBbackup\fR  lvm://vg0/home/path2/       lvm\-vg0/
.Sp
\&\fBbackup_script\fR   /usr/local/bin/backup_pgsql.sh    pgsql_backup/
.Sp
.RS 4
Examples:
.Sp
\&\fBbackup   /etc/        localhost/\fR
.Sp
.RS 4
Backs up /etc/ to <snapshot_root>/<retain>.0/localhost/etc/ using rsync on
the local filesystem
.RE
.RE
.RS 4
.Sp
\&\fBbackup   /usr/local/  localhost/\fR
.Sp
.RS 4
Backs up /usr/local/ to <snapshot_root>/<retain>.0/localhost/usr/local/
using rsync on the local filesystem
.RE
.RE
.RS 4
.Sp
\&\fBbackup   root@example.com:/etc/       example.com/\fR
.Sp
.RS 4
Backs up root@example.com:/etc/ to <snapshot_root>/<retain>.0/example.com/etc/
using rsync over ssh
.RE
.RE
.RS 4
.Sp
\&\fBbackup   root@example.com:/usr/local/ example.com/\fR
.Sp
.RS 4
Backs up root@example.com:/usr/local/ to
<snapshot_root>/<retain>.0/example.com/usr/local/ using rsync over ssh
.RE
.RE
.RS 4
.Sp
\&\fBbackup   rsync://example.com/pub/      example.com/pub/\fR
.Sp
.RS 4
Backs up rsync://example.com/pub/ to <snapshot_root>/<retain>.0/example.com/pub/
using an anonymous rsync server. Please note that unlike backing up local paths
and using rsync over ssh, rsync servers have \*(L"modules\*(R", which are top level
directories that are exported. Therefore, the module should also be specified in
the destination path, as shown in the example above (the pub/ directory at the
end).
.RE
.RE
.RS 4
.Sp
\&\fBbackup   /var/     localhost/   one_fs=1\fR
.Sp
.RS 4
This is the same as the other examples, but notice the fourth column.
This is how you specify per-backup-point options to over-ride global
settings.  This extra parameter can take several options, separated
by \fBcommas\fR.
.Sp
It is most useful when specifying per-backup rsync excludes thus:
.Sp
\&\fBbackup  root@somehost:/  somehost   +rsync_long_args=\-\-exclude=/var/spool/\fR
.Sp
Note the + sign.  That tells rsnapshot to \fIadd\fR to the list of arguments
to pass to rsync instead of replacing the list.
.RE
.RE
.RS 4
.Sp
\&\fBbackup  lvm://vg0/home/path2/       lvm\-vg0/\fR
.Sp
.RS 4
Backs up the \s-1LVM\s0 logical volume called home, of volume group vg0, to 
<snapshot_root>/<interval>.0/lvm\-vg0/. Will create, mount, backup, unmount and remove an \s-1LVM\s0 
snapshot for each lvm:// entry.
.RE
.RE
.RS 4
.Sp
\&\fBbackup_script      /usr/local/bin/backup_database.sh   db_backup/\fR
.Sp
.RS 4
In this example, we specify a script or program to run. This script should simply
create files and/or directories in its current working directory. rsnapshot will
then take that output and move it into the directory specified in the third column.
.Sp
Please note that whatever is in the destination directory will be completely
deleted and recreated. For this reason, rsnapshot prevents you from specifying
a destination directory for a backup_script that will clobber other backups.
.Sp
So in this example, say the backup_database.sh script simply runs a command like:
.Sp
.RS 4
#!/bin/sh
.Sp
mysqldump \-uusername mydatabase > mydatabase.sql
.Sp
chmod u=r,go= mydatabase.sql	# r\-\-\-\-\-\-\-\- (0400)
.RE
.RE
.RS 4
.Sp
rsnapshot will take the generated \*(L"mydatabase.sql\*(R" file and move it into the
<snapshot_root>/<retain>.0/db_backup/ directory. On subsequent runs,
rsnapshot checks the differences between the files created against the
previous files. If the backup script generates the same output on the next
run, the files will be hard linked against the previous ones, and no
additional disk space will be taken up.
.RE
.RE
.RS 4
.RE
.RE
.RS 4
.Sp
Remember that tabs must separate all elements, and that
there must be a trailing slash on the end of every directory.
.Sp
A hash mark (#) on the beginning of a line is treated
as a comment.
.Sp
Putting it all together (an example file):
.Sp
.Vb 1
\&    # THIS IS A COMMENT, REMEMBER TABS MUST SEPARATE ALL ELEMENTS
.Ve
.Sp
.Vb 1
\&    config_version  1.2
.Ve
.Sp
.Vb 1
\&    snapshot_root   /.snapshots/
.Ve
.Sp
.Vb 6
\&    cmd_rsync           /usr/bin/rsync
\&    cmd_ssh             /usr/bin/ssh
\&    #cmd_cp             /bin/cp
\&    cmd_rm              /bin/rm
\&    cmd_logger          /usr/bin/logger
\&    cmd_du              /usr/bin/du
.Ve
.Sp
.Vb 4
\&    linux_lvm_cmd_lvcreate        /sbin/lvcreate
\&    linux_lvm_cmd_lvremove        /sbin/lvremove
\&    linux_lvm_cmd_mount           /bin/mount
\&    linux_lvm_cmd_umount          /bin/umount
.Ve
.Sp
.Vb 4
\&    linux_lvm_snapshotsize    2G
\&    linux_lvm_snapshotname    rsnapshot
\&    linux_lvm_vgpath          /dev
\&    linux_lvm_mountpath       /mnt/lvm-snapshot
.Ve
.Sp
.Vb 4
\&    retain              hourly  6
\&    retain              daily   7
\&    retain              weekly  7
\&    retain              monthly 3
.Ve
.Sp
.Vb 3
\&    backup              /etc/                     localhost/
\&    backup              /home/                    localhost/
\&    backup_script       /usr/local/bin/backup_mysql.sh  mysql_backup/
.Ve
.Sp
.Vb 5
\&    backup              root@foo.com:/etc/        foo.com/
\&    backup              root@foo.com:/home/       foo.com/
\&    backup              root@mail.foo.com:/home/  mail.foo.com/
\&    backup              rsync://example.com/pub/  example.com/pub/
\&    backup              lvm://vg0/xen-home/       lvm-vg0/xen-home/
.Ve
.RE
.RS 4
.SH "USAGE"
.IX Header "USAGE"
\&\fBrsnapshot\fR can be used by any user, but for system-wide backups
you will probably want to run it as root.
.Sp
Since backups usually get neglected if human intervention is
required, the preferred way is to run it from cron.
.Sp
When you are first setting up your backups, you will probably
also want to run it from the command line once or twice to get
a feel for what it's doing.
.Sp
Here is an example crontab entry, assuming that backup levels \fBhourly\fR,
\&\fBdaily\fR, \fBweekly\fR and \fBmonthly\fR have been defined in \fB/etc/rsnapshot.conf\fR
.Sp
.RS 4
\&\fB0 */4 * * *         /usr/local/bin/rsnapshot hourly\fR
.Sp
\&\fB50 23 * * *         /usr/local/bin/rsnapshot daily\fR
.Sp
\&\fB40 23 * * 6         /usr/local/bin/rsnapshot weekly\fR
.Sp
\&\fB30 23 1 * *         /usr/local/bin/rsnapshot monthly\fR
.RE
.RE
.RS 4
.Sp
This example will do the following:
.Sp
.RS 4
6 hourly backups a day (once every 4 hours, at 0,4,8,12,16,20)
.Sp
1 daily backup every day, at 11:50PM
.Sp
1 weekly backup every week, at 11:40PM, on Saturdays (6th day of week)
.Sp
1 monthly backup every month, at 11:30PM on the 1st day of the month
.RE
.RE
.RS 4
.Sp
It is usually a good idea to schedule the larger backup levels to run a bit before the
lower ones. For example, in the crontab above, notice that \*(L"daily\*(R" runs 10 minutes
before \*(L"hourly\*(R".  The main reason for this is that the daily rotate will
pull out the oldest hourly and make that the youngest daily (which means
that the next hourly rotate will not need to delete the oldest hourly),
which is more efficient.  A secondary reason is that it is harder to
predict how long the lowest backup level will take, since it needs to actually
do an rsync of the source as well as the rotate that all backups do.
.Sp
If rsnapshot takes longer than 10 minutes to do the \*(L"daily\*(R" rotate
(which usually includes deleting the oldest daily snapshot), then you
should increase the time between the backup levels.
Otherwise (assuming you have set the \fBlockfile\fR parameter, as is recommended)
your hourly snapshot will fail sometimes because the daily still has the lock.  
.Sp
Remember that these are just the times that the program runs.
To set the number of backups stored, set the \fBretain\fR numbers in
\&\fB/etc/rsnapshot.conf\fR
.Sp
To check the disk space used by rsnapshot, you can call it with the \*(L"du\*(R" argument.
.Sp
For example:
.Sp
.RS 4
\&\fBrsnapshot du\fR
.RE
.RE
.RS 4
.Sp
This will show you exactly how much disk space is taken up in the snapshot root. This
feature requires the \s-1UNIX\s0 \fBdu\fR command to be installed on your system, for it to
support the \*(L"\-csh\*(R" command line arguments, and to be in your path. You can also
override your path settings and the flags passed to du using the cmd_du and du_args
parameters.
.Sp
It is also possible to pass a relative file path as a second argument, to get a report
on a particular file or subdirectory.
.Sp
.RS 4
\&\fBrsnapshot du localhost/home/\fR
.RE
.RE
.RS 4
.Sp
The \s-1GNU\s0 version of \*(L"du\*(R" is preferred. The \s-1BSD\s0 version works well also, but does
not support the \-h flag (use \-k instead, to see the totals in kilobytes). Other
versions of \*(L"du\*(R", such as Solaris, may not work at all.
.Sp
To check the differences between two directories, call rsnapshot with the \*(L"diff\*(R"
argument, followed by two backup levels or directory paths.
.Sp
For example:
.Sp
.RS 4
\&\fBrsnapshot diff daily.0 daily.1\fR
.Sp
\&\fBrsnapshot diff daily.0/localhost/etc daily.1/localhost/etc\fR
.Sp
\&\fBrsnapshot diff /.snapshots/daily.0 /.snapshots/daily.1\fR
.RE
.RE
.RS 4
.Sp
This will call the rsnapshot-diff program, which will scan both directories
looking for differences (based on hard links).
.Sp
\&\fBrsnapshot sync\fR
.Sp
.RS 4
When \fBsync_first\fR is enabled, rsnapshot must first be called with the \fBsync\fR
argument, followed by the other usual cron entries. The sync should happen as
the lowest, most frequent backup level, and right before. For example:
.Sp
.RS 4
\&\fB0 */4 * * *         /usr/local/bin/rsnapshot sync && /usr/local/bin/rsnapshot hourly\fR
.Sp
\&\fB50 23 * * *         /usr/local/bin/rsnapshot daily\fR
.Sp
\&\fB40 23 1,8,15,22 * * /usr/local/bin/rsnapshot weekly\fR
.Sp
\&\fB30 23 1 * *         /usr/local/bin/rsnapshot monthly\fR
.RE
.RE
.RS 4
.Sp
The sync operation simply runs rsync and all backup scripts. In this scenario, all
calls simply rotate directories, even the lowest backup level.
.RE
.RE
.RS 4
.Sp
\&\fBrsnapshot sync [dest]\fR
.Sp
.RS 4
When \fBsync_first\fR is enabled, all sync behaviour happens during an additional
sync step (see above). When using the sync argument, it is also possible to specify
a backup point destination as an optional parameter. If this is done, only backup
points sharing that destination path will be synced.
.Sp
For example, let's say that example.com is a destination path shared by one or more
of your backup points.
.Sp
.RS 4
rsnapshot sync example.com
.RE
.RE
.RS 4
.Sp
This command will only sync the files that normally get backed up into example.com.
It will \s-1NOT\s0 get any other backup points with slightly different values (like
example.com/etc/, for example). In order to sync example.com/etc, you would need to
run rsnapshot again, using example.com/etc as the optional parameter.
.RE
.RE
.RS 4
.SH "EXIT VALUES"
.IX Header "EXIT VALUES"
.RS 4
\&\fB0\fR  All operations completed successfully
.Sp
\&\fB1\fR  A fatal error occurred
.Sp
\&\fB2\fR  Some warnings occurred, but the backup still finished
.RE
.RE
.RS 4
.SH "FILES"
.IX Header "FILES"
/etc/rsnapshot.conf
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIrsync\fR\|(1), \fIssh\fR\|(1), \fIlogger\fR\|(1), \fIsshd\fR\|(1), \fIssh\-keygen\fR\|(1), \fIperl\fR\|(1), \fIcp\fR\|(1), \fIdu\fR\|(1), \fIcrontab\fR\|(1)
.SH "DIAGNOSTICS"
.IX Header "DIAGNOSTICS"
Use the \fB\-t\fR flag to see what commands would have been executed. This will show
you the commands rsnapshot would try to run. There are a few minor differences
(for example, not showing an attempt to remove the lockfile because it wasn't
really created in the test), but should give you a very good idea what will happen.
.Sp
Using the \fB\-v\fR, \fB\-V\fR, and \fB\-D\fR flags will print increasingly more information
to \s-1STDOUT\s0.
.Sp
Make sure you don't have spaces in the config file that you think are actually tabs.
.Sp
Much other weird behavior can probably be attributed to plain old file system
permissions and ssh authentication issues.
.SH "BUGS"
.IX Header "BUGS"
Please report bugs (and other comments) to the rsnapshot-discuss mailing list:
.Sp
\&\fBhttp://lists.sourceforge.net/lists/listinfo/rsnapshot\-discuss\fR
.SH "NOTES"
.IX Header "NOTES"
Make sure your /etc/rsnapshot.conf file has all elements separated by tabs.
See /etc/rsnapshot.conf.default for a working example file.
.Sp
Make sure you put a trailing slash on the end of all directory references.
If you don't, you may have extra directories created in your snapshots.
For more information on how the trailing slash is handled, see the
\&\fB\f(BIrsync\fB\|(1)\fR manpage.
.Sp
Make sure to make the snapshot directory chmod 700 and owned by root
(assuming backups are made by the root user). If the snapshot directory
is readable by other users, they will be able to modify the snapshots
containing their files, thus destroying the integrity of the snapshots.
.Sp
If you would like regular users to be able to restore their own backups,
there are a number of ways this can be accomplished. One such scenario
would be:
.Sp
Set \fBsnapshot_root\fR to \fB/.private/.snapshots\fR in \fB/etc/rsnapshot.conf\fR
.Sp
Set the file permissions on these directories as follows:
.Sp
.RS 4
drwx\-\-\-\-\-\-    /.private
.Sp
drwxr-xr-x    /.private/.snapshots
.RE
.RE
.RS 4
.Sp
Export the /.private/.snapshots directory over read-only \s-1NFS\s0, a read-only
Samba share, etc.
.Sp
See the rsnapshot \s-1HOWTO\s0 for more information on making backups
accessible to non-privileged users.
.Sp
For ssh to work unattended through cron, you will probably want to use
public key logins. Create an ssh key with no passphrase for root, and
install the public key on each machine you want to backup. If you are
backing up system files from remote machines, this probably means
unattended root logins. Another possibility is to create a second user
on the machine just for backups. Give the user a different name such
as \*(L"rsnapshot\*(R", but keep the \s-1UID\s0 and \s-1GID\s0 set to 0, to give root
privileges. However, make logins more restrictive, either through ssh
configuration, or using an alternate shell.
.Sp
\&\s-1BE\s0 \s-1CAREFUL\s0! If the private key is obtained by an attacker, they will
have free run of all the systems involved. If you are unclear on how
to do this, see \fB\f(BIssh\fB\|(1)\fR, \fB\f(BIsshd\fB\|(1)\fR, and \fB\f(BIssh\-keygen\fB\|(1)\fR.
.Sp
Backup scripts are run as the same user that rsnapshot is running as.
Typically this is root. Make sure that all of your backup scripts are
only writable by root, and that they don't call any other programs
that aren't owned by root. If you fail to do this, anyone who can
write to the backup script or any program it calls can fully take
over the machine. Of course, this is not a situation unique to
rsnapshot.
.Sp
By default, rsync transfers are done using the \-\-numeric\-ids option.
This means that user names and group names are ignored during transfers,
but the \s-1UID/GID\s0 information is kept intact. The assumption is that the
backups will be restored in the same environment they came from. Without
this option, restoring backups for multiple heterogeneous servers would
be unmanageable. If you are archiving snapshots with \s-1GNU\s0 tar, you may
want to use the \-\-numeric\-owner parameter. Also, keep a copy of the
archived system's /etc/passwd and /etc/group files handy for the \s-1UID/GID\s0
to name mapping.
.Sp
If you remove backup points in the config file, the previously archived
files under those points will permanently stay in the snapshots directory
unless you remove the files yourself. If you want to conserve disk space,
you will need to go into the <snapshot_root> directory and manually
remove the files from the smallest backup level's \*(L".0\*(R" directory.
.Sp
For example, if you were previously backing up /home/ with a destination
of localhost/, and hourly is your smallest backup level, you would need to do
the following to reclaim that disk space:
.Sp
.RS 4
rm \-rf <snapshot_root>/hourly.0/localhost/home/
.RE
.RE
.RS 4
.Sp
Please note that the other snapshots previously made of /home/ will still
be using that disk space, but since the files are flushed out of hourly.0/,
they will no longer be copied to the subsequent directories, and will thus
be removed in due time as the rotations happen.
.SH "AUTHORS"
.IX Header "AUTHORS"
Mike Rubel \- \fBhttp://www.mikerubel.org/computers/rsync_snapshots/\fR
.IP "\- Created the original shell scripts on which this project is based" 4
.IX Item "- Created the original shell scripts on which this project is based"
.RE
.RS 4
.Sp
Nathan Rosenquist (\fBnathan@rsnapshot.org\fR)
.IP "\- Primary author and previous maintainer of rsnapshot." 4
.IX Item "- Primary author and previous maintainer of rsnapshot."
.RE
.RS 4
.Sp
David Cantrell (\fBdavid@cantrell.org.uk\fR)
.IP "\- Current co-maintainer of rsnapshot" 4
.IX Item "- Current co-maintainer of rsnapshot"
.PD 0
.IP "\- Wrote the rsnapshot-diff utility" 4
.IX Item "- Wrote the rsnapshot-diff utility"
.IP "\- Improved how use_lazy_deletes work so slow deletes don't screw up the next backup at that backup level." 4
.IX Item "- Improved how use_lazy_deletes work so slow deletes don't screw up the next backup at that backup level."
.RE
.RS 4
.PD
.Sp
David Keegel <djk@cybersource.com.au>
.IP "\- Co\-maintainer, with responsibility for release management since 1.2.9" 4
.IX Item "- Co-maintainer, with responsibility for release management since 1.2.9"
.PD 0
.IP "\- Fixed race condition in lock file creation, improved error reporting" 4
.IX Item "- Fixed race condition in lock file creation, improved error reporting"
.ie n .IP "\- Allowed remote ssh directory paths starting with ""~/"" as well as ""/""" 4
.el .IP "\- Allowed remote ssh directory paths starting with ``~/'' as well as ``/''" 4
.IX Item "- Allowed remote ssh directory paths starting with ~/ as well as /"
.IP "\- Fixed a number of other bugs and buglets" 4
.IX Item "- Fixed a number of other bugs and buglets"
.RE
.RS 4
.PD
.Sp
Carl Wilhelm Soderstrom \fB(chrome@real\-time.com)\fR
.IP "\- Created the \s-1RPM\s0 .spec file which allowed the \s-1RPM\s0 package to be built, among other things." 4
.IX Item "- Created the RPM .spec file which allowed the RPM package to be built, among other things."
.RE
.RS 4
.Sp
Ted Zlatanov (\fBtzz@lifelogs.com\fR)
.IP "\- Added the one_fs feature, autoconf support, good advice, and much more." 4
.IX Item "- Added the one_fs feature, autoconf support, good advice, and much more."
.RE
.RS 4
.Sp
Ralf van Dooren (\fBr.vdooren@snow.nl\fR)
.IP "\- Added and maintains the rsnapshot entry in the FreeBSD ports tree." 4
.IX Item "- Added and maintains the rsnapshot entry in the FreeBSD ports tree."
.RE
.RS 4
.Sp
SlapAyoda
.IP "\- Provided access to his computer museum for software testing." 4
.IX Item "- Provided access to his computer museum for software testing."
.RE
.RS 4
.Sp
Carl Boe (\fBboe@demog.berkeley.edu\fR)
.IP "\- Found several subtle bugs and provided fixes for them." 4
.IX Item "- Found several subtle bugs and provided fixes for them."
.RE
.RS 4
.Sp
Shane Leibling (\fBshane@cryptio.net\fR)
.IP "\- Fixed a compatibility bug in utils/backup_smb_share.sh" 4
.IX Item "- Fixed a compatibility bug in utils/backup_smb_share.sh"
.RE
.RS 4
.Sp
Christoph Wegscheider (\fBchristoph.wegscheider@wegi.net\fR)
.IP "\- Added (and previously maintained) the Debian rsnapshot package." 4
.IX Item "- Added (and previously maintained) the Debian rsnapshot package."
.RE
.RS 4
.Sp
Bharat Mediratta (\fBbharat@menalto.com\fR)
.IP "\- Improved the exclusion rules to avoid backing up the snapshot root (among other things)." 4
.IX Item "- Improved the exclusion rules to avoid backing up the snapshot root (among other things)."
.RE
.RS 4
.Sp
Peter Palfrader (\fBweasel@debian.org\fR)
.IP "\- Enhanced error reporting to include command line options." 4
.IX Item "- Enhanced error reporting to include command line options."
.RE
.RS 4
.Sp
Nicolas Kaiser (\fBnikai@nikai.net\fR)
.IP "\- Fixed typos in program and man page" 4
.IX Item "- Fixed typos in program and man page"
.RE
.RS 4
.Sp
Chris Petersen \- (\fBhttp://www.forevermore.net/\fR)
.Sp
.RS 4
Added cwrsync permanent-share support
.RE
.RE
.RS 4
.Sp
Robert Jackson (\fBRobertJ@promedicalinc.com\fR)
.Sp
.RS 4
Added use_lazy_deletes feature
.RE
.RE
.RS 4
.Sp
Justin Grote (\fBjustin@grote.name\fR)
.Sp
.RS 4
Improved rsync error reporting code
.RE
.RE
.RS 4
.Sp
Anthony Ettinger (\fBapwebdesign@yahoo.com\fR)
.Sp
.RS 4
Wrote the utils/mysqlbackup.pl script
.RE
.RE
.RS 4
.Sp
Sherman Boyd
.Sp
.RS 4
Wrote utils/random_file_verify.sh script
.RE
.RE
.RS 4
.Sp
William Bear (\fBbear@umn.edu\fR)
.Sp
.RS 4
Wrote the utils/rsnapreport.pl script (pretty summary of rsync stats)
.RE
.RE
.RS 4
.Sp
Eric Anderson (\fBanderson@centtech.com\fR)
.Sp
.RS 4
Improvements to utils/rsnapreport.pl.
.RE
.RE
.RS 4
.Sp
Alan Batie (\fBalan@batie.org\fR)
.Sp
.RS 4
Bug fixes for include_conf
.RE
.RE
.RS 4
.Sp
Dieter Bloms (\fBdieter@bloms.de\fR)
.Sp
.RS 4
Multi-line configuration options
.RE
.RE
.RS 4
.Sp
Henning Moll (\fBnewsScott@gmx.de\fR)
.Sp
.RS 4
stop_on_stale_lockfile
.RE
.RE
.RS 4
.Sp
Ben Low (\fBben@bdlow.net\fR)
.Sp
.RS 4
Linux \s-1LVM\s0 snapshot support
.RE
.RE
.RS 4
.SH "COPYRIGHT"
.IX Header "COPYRIGHT"
Copyright (C) 2003\-2005 Nathan Rosenquist
.Sp
Portions Copyright (C) 2002\-2007 Mike Rubel, Carl Wilhelm Soderstrom,
Ted Zlatanov, Carl Boe, Shane Liebling, Bharat Mediratta, Peter Palfrader,
Nicolas Kaiser, David Cantrell, Chris Petersen, Robert Jackson, Justin Grote,
David Keegel, Alan Batie, Dieter Bloms, Henning Moll, Ben Low, Anthony
Ettinger
.Sp
This man page is distributed under the same license as rsnapshot:
the \s-1GPL\s0 (see below).
.Sp
This program is free software; you can redistribute it and/or modify
it under the terms of the \s-1GNU\s0 General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.
.Sp
This program is distributed in the hope that it will be useful,
but \s-1WITHOUT\s0 \s-1ANY\s0 \s-1WARRANTY\s0; without even the implied warranty of
\&\s-1MERCHANTABILITY\s0 or \s-1FITNESS\s0 \s-1FOR\s0 A \s-1PARTICULAR\s0 \s-1PURPOSE\s0.  See the
\&\s-1GNU\s0 General Public License for more details.
.Sp
You should have received a copy of the \s-1GNU\s0 General Public License along
with this program; if not, write to the Free Software Foundation, Inc.,
51 Franklin Street, Fifth Floor, Boston, \s-1MA\s0  02110\-1301 \s-1USA\s0
